
jQuery('document').ready(function(){if(jQuery("#trafficWidget").is('*')){var loadJSON=function(choice){jQuery('#items').empty();jQuery('<img src="/img/modules/traffic/ajax-loader.gif" /><br /><span>Loading</span>').appendTo("#items")
var url=(choice?"/rest/1.0/traffic/current.json?road_id="+choice:"/rest/1.0/traffic/current.json");jQuery('#HtArrows').hide();jQuery.getJSON(url,function(data){jQuery('#items').empty();if(isObjectEmpty(data)){jQuery("#items").html("<div class='item-wrap'><span class='notice'><i>No Incidents To Report</i></span></div>");return;}
if(countJSONItems(data)>1){jQuery('#HtArrows').show();}
if(data.error){jQuery("#items").html("<div class='item-wrap'><span class='notice'><i>"+data.error+"</i></span></div>");return;}
jQuery.each(data,function(i,incident){var incident_id="i-"+i;var roadway=incident.highway+(incident.direction?' '+incident.direction+' ':' ');var location=(incident.location?'at '+incident.location+' ':'at Unknown ');var description=incident.description+': '+roadway+location;var img_url="/img/modules/traffic/"+incident.image_filename;jQuery('<div id="'+incident_id+'" class="item-wrap" style="display:none">').appendTo('#items');jQuery('<img class="thumb" src="'+img_url+'" />').appendTo('#'+incident_id);jQuery('<span class="time">'+incident.started+' - </span>').appendTo('#'+incident_id);jQuery('<span class="notice">'+description+'</span>').appendTo('#'+incident_id);});jQuery('#items div.item-wrap:first').show();});};jQuery('#chRoadway').click(function(){jQuery('#popup').toggle();return false;});jQuery('.close_popup').click(function(){jQuery('#popup').hide();return false;});jQuery('.selections').click(function(event){var selected_value=jQuery(event.target).attr("value");var label_text=jQuery(event.target).parent().text();loadJSON(selected_value);jQuery('#popup').hide();jQuery('#road_name').html(label_text);document.cookie="trf="+selected_value+"; expires="+getExpireString(30)+";";});jQuery('.browse').click(function(event){var direction=jQuery(event.target).attr("title");if(direction=="next"){jQuery('div.item-wrap:visible').toggle().next().toggle();if(jQuery('div.item-wrap:visible').length==0){jQuery('div.item-wrap:first').show();}}else{jQuery('div.item-wrap:visible').toggle().prev().toggle();if(jQuery('div.item-wrap:visible').length==0){jQuery('div.item-wrap:last').show();}}});var cookie_value=getTrafficCookie('trf');if(cookie_value!=null&&cookie_value!=""){var field="input:radio[value="+cookie_value+"]";jQuery(field).trigger('click',[true]);}else{loadJSON();}}
if(jQuery("#trafficRecentWidget").is('*')){var url="/rest/1.0/traffic/recent.json";jQuery.getJSON(url,function(data){if(isObjectEmpty(data)){jQuery("#trafficRecentWidget").html("<div class='item-wrap'><span class='notice'><i>No Incidents</i></span></div>");return;}
jQuery.each(data,function(i,incident){var incident_id="i-"+i;var roadway=incident.highway+(incident.direction?' '+incident.direction+' ':' ');var location=(incident.location?'at '+incident.location+' ':'at Unknown ');var description=incident.description+': '+roadway+location;var img_url="/img/modules/traffic/"+incident.image_filename;jQuery('<div id="'+incident_id+'" class="incident">').appendTo('#trafficRecentWidget');jQuery('<div class="icon"><img src="'+img_url+'" /></div>').appendTo('#'+incident_id);jQuery('<div class="time">'+incident.started+' </div>').appendTo('#'+incident_id);jQuery('<div class="title"> - '+description+'</div>').appendTo('#'+incident_id);jQuery('<div class="date"> - '+incident.date+'</div>').appendTo('#'+incident_id);});});}});function getTrafficCookie(name){var results=document.cookie.match('(^|;) ?'+name+'=([^;]*)(;|jQuery)');if(results){return(unescape(results[2]));}else{return null;}}
function getExpireString(days){if(!days){days=60;}
var today=new Date();var expDate=new Date(today.getTime()+3600000*24*days);var expString=expDate.toGMTString();return expString;}